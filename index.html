<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>T·∫°o ƒê·ªÅ Ki·ªÉm Tra</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap');
  body { font-family: 'Inter', sans-serif; background-color: #1f2937; color: #facc15; }
  .text-yellow-500 { color: #facc15; }
  .bg-app { background-color: #ffffff; }
  .bg-muted { background-color: #f9fafb; }
  .ring-blue { --tw-ring-color: #93c5fd; }
</style>
</head>
<body class="p-6 flex justify-center items-start min-h-screen">

<div class="bg-app p-6 rounded-2xl shadow-xl max-w-4xl w-full">

<!-- Banner n·ªÅn xanh ƒë·∫≠m, ch·ªØ v√†ng, glow animation -->
<div class="bg-gradient-to-r from-blue-800 via-blue-900 to-indigo-900 p-6 rounded-2xl mb-6 text-center shadow-2xl transform hover:scale-105 transition duration-300">
  <h1 class="text-3xl sm:text-4xl font-bold mb-2 uppercase relative inline-block text-yellow-400" style="text-shadow: 2px 2px 4px rgba(0,0,0,0.7);">
<!-- Banner n·ªÅn xanh ƒë·∫≠m, ch·ªØ v√†ng, glow m∆∞·ª£t qua ch·ªØ ch√≠nh -->
<div class="bg-gradient-to-r from-blue-800 via-blue-900 to-indigo-900 p-6 rounded-2xl mb-6 text-center shadow-2xl transform hover:scale-105 transition duration-300 relative overflow-hidden">
  <h1 class="text-3xl sm:text-4xl font-bold mb-2 uppercase relative inline-block text-yellow-400 z-10" style="text-shadow: 2px 2px 4px rgba(0,0,0,0.7);">
    TR∆Ø·ªúNG THCS H√ÄM MINH
    <!-- Glow effect -->
    <span class="absolute inset-0 bg-gradient-to-r from-white via-yellow-200 to-white opacity-20 animate-glow"></span>
    <span class="glow"></span>
  </h1>
  <h2 class="text-2xl sm:text-3xl font-semibold mb-2" style="text-shadow: 1px 1px 3px rgba(0,0,0,0.6);">T·ªï To√°n - Tin</h2>
  <p class="text-lg sm:text-xl mb-1" style="text-shadow: 1px 1px 3px rgba(0,0,0,0.5);">Ch∆∞∆°ng tr√¨nh t·∫°o ƒë·ªÅ ki·ªÉm tra ƒë·ªãnh k√¨ theo c√¥ng vƒÉn 7791</p>
  <p class="text-lg sm:text-xl font-medium" style="text-shadow: 1px 1px 3px rgba(0,0,0,0.5);">NƒÉm h·ªçc 2025 - 2026</p>
  <h2 class="text-2xl sm:text-3xl font-semibold mb-2 z-10" style="text-shadow: 1px 1px 3px rgba(0,0,0,0.6);">T·ªï To√°n - Tin</h2>
  <p class="text-lg sm:text-xl mb-1 z-10" style="text-shadow: 1px 1px 3px rgba(0,0,0,0.5);">Ch∆∞∆°ng tr√¨nh t·∫°o ƒë·ªÅ ki·ªÉm tra ƒë·ªãnh k√¨ theo c√¥ng vƒÉn 7791</p>
  <p class="text-lg sm:text-xl font-medium z-10" style="text-shadow: 1px 1px 3px rgba(0,0,0,0.5);">NƒÉm h·ªçc 2025 - 2026</p>
</div>

<style>
@keyframes glowMove {
  0% { transform: translateX(-100%); }
  50% { transform: translateX(100%); }
  100% { transform: translateX(-100%); }
}

.animate-glow {
  mix-blend-mode: screen;
/* Glow animation ch·ªâ cho ch·ªØ ch√≠nh */
.glow {
  position: absolute;
  top: 0;
  left: -150%;
  width: 150%;
  height: 100%;
  background: linear-gradient(90deg, rgba(255,255,255,0) 0%, rgba(255,255,255,0.4) 50%, rgba(255,255,255,0) 100%);
  transform: skewX(-20deg);
  animation: glowMove 3s linear infinite;
  pointer-events: none;
  z-index: 0;
  display: block;
  animation: glowMove 3s linear infinite;
}

@keyframes glowMove {
  0% { left: -150%; }
  50% { left: 100%; }
  100% { left: -150%; }
}
</style>


  <!-- Form nh·∫≠p -->
  <form id="examForm" class="grid grid-cols-1 md:grid-cols-2 gap-4">
    <div>
      <label class="block text-gray-700 mb-1">M√¥n h·ªçc</label>
      <select id="subject" class="w-full px-4 py-2 border rounded-lg bg-gray-100 text-gray-900">
        <option selected>To√°n</option>
        <option>Tin</option>
      </select>
    </div>

    <div>
      <label class="block text-gray-700 mb-1">Kh·ªëi</label>
      <select id="grade" class="w-full px-4 py-2 border rounded-lg">
        <option>6</option>
        <option>7</option>
        <option>8</option>
        <option selected>9</option>
      </select>
    </div>

<div>
      <label class="block text-gray-700 mb-1">K√¨ ki·ªÉm tra</label>
      <select id="topic" class="w-full px-4 py-2 border rounded-lg">
        <option>Gi·ªØa k√¨ 1</option>
        <option>Cu·ªëi k√¨ 1</option>
        <option>Gi·ªØa k√¨ 2</option>
        <option selected>Cu·ªëi k√¨ 2</option>
      </select>
    </div>

    <div class="md:col-span-2">
      <label class="block text-gray-700 mb-1">Ghi ch√∫ (t√πy ch·ªçn)</label>
      <textarea id="notes" rows="2" placeholder="V√≠ d·ª•: ƒê·∫°i s·ªë ‚Äì h·ªá hai ph∆∞∆°ng tr√¨nh b·∫≠c nh·∫•t..." class="w-full px-4 py-2 border rounded-lg text-gray-800"></textarea>
    </div>

    <div class="md:col-span-2 flex gap-2 mt-2">
      <button type="button" id="createMatrixButton" class="w-full px-4 py-2 bg-blue-600 text-white rounded-lg">T·∫°o ma tr·∫≠n ƒë·ªÅ</button>
      <button type="button" id="createTableButton" class="w-full px-4 py-2 bg-blue-600 text-white rounded-lg">T·∫°o b·∫£ng ƒë·∫∑c t·∫£</button>
      <button type="submit" id="generateButton" class="w-full px-4 py-2 bg-blue-600 text-white rounded-lg">T·∫°o ƒê·ªÅ Ki·ªÉm Tra ‚ú®</button>
    </div>

 </form>

  <!-- K·∫øt qu·∫£ -->
  <div id="statusContainer" class="mt-6 hidden">
    <div id="loadingIndicator" class="flex justify-center items-center flex-col hidden">
      <div class="animate-spin h-12 w-12 border-4 border-gray-400 border-t-blue-500 rounded-full"></div>
      <p class="mt-2 text-gray-500">ƒêang t·∫°o n·ªôi dung...</p>
    </div>

    <div id="examOutput" class="hidden mt-4">
      <div class="flex gap-2 mb-2">
        <button id="copyMarkdownButton" class="px-3 py-1 bg-gray-200 rounded-lg text-gray-700">Copy Markdown</button>
        <button id="downloadMarkdownButton" class="px-3 py-1 bg-gray-200 rounded-lg text-gray-700">Download .md</button>
      </div>
      <textarea id="markdownContent" rows="10" class="w-full p-2 border rounded-lg mb-4" readonly></textarea>

      <div class="flex gap-2 mb-2">
        <button id="copyLatexButton" class="px-3 py-1 bg-gray-200 rounded-lg text-gray-700">Copy LaTeX</button>
        <button id="downloadLatexButton" class="px-3 py-1 bg-gray-200 rounded-lg text-gray-700">Download .tex</button>
      </div>
      <textarea id="latexContent" rows="10" class="w-full p-2 border rounded-lg" readonly></textarea>
    </div>

 <div id="errorContainer" class="hidden text-red-700 bg-red-100 p-2 rounded-lg mt-2"></div>
  </div>
</div>
    <script>
  const GEMINI_API_KEY = "AIzaSyD4Zg_Gr8d_WeSEexmc255aZqXFeetkABQ";   // üëâ D√°n API key tr·ª±c ti·∫øp v√†o ƒë√¢y
  const GEMINI_MODEL   = "gemini-2.5-flash";

  const gradeSelect = document.getElementById('grade');
  const topicSelect = document.getElementById('topic');
  const notesInput = document.getElementById('notes');
  const subjectSelect = document.getElementById('subject');
  const statusContainer = document.getElementById('statusContainer');
  const loadingIndicator = document.getElementById('loadingIndicator');
  const examOutput = document.getElementById('examOutput');
  const markdownContent = document.getElementById('markdownContent');
  const latexContent = document.getElementById('latexContent');
  const errorContainer = document.getElementById('errorContainer');

  const generateButton = document.getElementById('generateButton');
  const createMatrixButton = document.getElementById('createMatrixButton');
  const createTableButton = document.getElementById('createTableButton');

  const copyMarkdownButton = document.getElementById('copyMarkdownButton');
  const copyLatexButton = document.getElementById('copyLatexButton');
  const downloadMarkdownButton = document.getElementById('downloadMarkdownButton');
  const downloadLatexButton = document.getElementById('downloadLatexButton');

  function hideStates(){
    loadingIndicator.classList.add('hidden');
    examOutput.classList.add('hidden');
    errorContainer.classList.add('hidden');
    statusContainer.classList.add('hidden');
  }

  function setBusy(flag){
    [generateButton, createMatrixButton, createTableButton].forEach(b=>b.disabled=flag);
    if(flag){statusContainer.classList.remove('hidden'); loadingIndicator.classList.remove('hidden');}
    else{loadingIndicator.classList.add('hidden');}
  }

  function showError(msg){
    errorContainer.textContent = msg;
    errorContainer.classList.remove('hidden');
  }

  function buildPrompt(type){
    const grade = gradeSelect.value;
    const topic = topicSelect.value;
    const subject = subjectSelect.value;
    const notes = notesInput.value.trim();
    const scopeNote = notes?`\nGi·ªõi h·∫°n n·ªôi dung: ${notes}\n`:'';  
    if(type==='matrix') return `T·∫°o ma tr·∫≠n ƒë·ªÅ ki·ªÉm tra m√¥n ${subject} kh·ªëi ${grade}, k√¨ "${topic}".${scopeNote}\nCh·ªâ tr·∫£ l·ªùi Markdown r·ªìi LaTeX.`;  
    if(type==='table') return `T·∫°o b·∫£ng ƒë·∫∑c t·∫£ ƒë·ªÅ ki·ªÉm tra m√¥n ${subject} kh·ªëi ${grade}, k√¨ "${topic}".${scopeNote}\nCh·ªâ tr·∫£ l·ªùi Markdown r·ªìi LaTeX.`;  
    return `T·∫°o ƒë·ªÅ ki·ªÉm tra m√¥n ${subject} kh·ªëi ${grade}, k√¨ "${topic}".${scopeNote}\nMarkdown r·ªìi LaTeX.`;  
  }

  async function callGeminiAPI(prompt){
    if(!GEMINI_API_KEY) throw new Error('Thi·∫øu API key');
    const url = `https://generativelanguage.googleapis.com/v1beta/models/${encodeURIComponent(GEMINI_MODEL)}:generateContent?key=${encodeURIComponent(GEMINI_API_KEY)}`;
    const payload = { contents:[{parts:[{text:prompt}]}] };
    const res = await fetch(url,{method:'POST',headers:{'Content-Type':'application/json'},body: JSON.stringify(payload)});
    if(!res.ok) throw new Error('API l·ªói '+res.status);
    const data = await res.json();
    return data?.candidates?.[0]?.content?.parts?.map(p=>p.text).join('\n')||'';
  }

  function extractBlocks(text){
    const md = (text.match(/```markdown\n([\s\S]*?)```/i)||[])[1]||'';
    const tex = (text.match(/```latex\n([\s\S]*?)```/i)||[])[1]||'';
    return {md,tex};
  }

  async function handleGeneration(type){
    hideStates();
    setBusy(true);
    try{
      const prompt = buildPrompt(type);
      const result = await callGeminiAPI(prompt);
      const {md,tex} = extractBlocks(result);
      markdownContent.value = md;
      latexContent.value = tex;
      statusContainer.classList.remove('hidden');
      examOutput.classList.remove('hidden');
    }catch(e){
      showError(e.message||e);
    }finally{
      setBusy(false);
    }
  }

  async function copyToClipboard(text){
    try{await navigator.clipboard.writeText(text);}catch{
      const ta = document.createElement('textarea'); ta.value=text; document.body.appendChild(ta); ta.select(); document.execCommand('copy'); ta.remove();
    }
  }
  function downloadFile(filename, content){
    const blob = new Blob([content], {type:'text/plain;charset=utf-8'});
    const a = document.createElement('a'); a.href=URL.createObjectURL(blob); a.download=filename; a.click(); URL.revokeObjectURL(a.href);
  }

  // Events
  createMatrixButton.addEventListener('click', ()=>handleGeneration('matrix'));
  createTableButton.addEventListener('click', ()=>handleGeneration('table'));
  generateButton.addEventListener('click', e=>{ e.preventDefault(); handleGeneration('exam'); });

  copyMarkdownButton.addEventListener('click', ()=>copyToClipboard(markdownContent.value));
  copyLatexButton.addEventListener('click', ()=>copyToClipboard(latexContent.value));

  downloadMarkdownButton.addEventListener('click', ()=>downloadFile(`de-${subjectSelect.value}-${gradeSelect.value}-${topicSelect.value}.md`, markdownContent.value));
  downloadLatexButton.addEventListener('click', ()=>downloadFile(`de-${subjectSelect.value}-${gradeSelect.value}-${topicSelect.value}.tex`, latexContent.value));
  </script>
</body>
</html>
